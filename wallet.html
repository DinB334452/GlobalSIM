<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wallet - GlobalSim</title>
</head>
<body>
  <h2>Top Up Wallet</h2>
  <form id="topupForm">
    <p>Send payment to: <strong>Bank Name: GlobalBank / Acc: 1234567890</strong></p>
    <input type="file" id="proof" required><br>
    <button type="submit">Submit Proof</button>
  </form>

  <script type="module">
    import { auth, onAuthStateChanged } from './firebase.js';
    import { getStorage, ref, uploadBytes } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const storage = getStorage();
    const db = getFirestore();

    onAuthStateChanged(auth, (user) => {
      if (!user) window.location.href = "login.html";

      document.getElementById("topupForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const file = document.getElementById("proof").files[0];
        if (!file) return alert("Please upload payment proof");

        const proofRef = ref(storage, "proofs/" + user.uid + "_" + Date.now());
        await uploadBytes(proofRef, file);
        await setDoc(doc(db, "topups", user.uid + "_" + Date.now()), {
          user: user.uid,
          email: user.email,
          timestamp: new Date(),
          status: "pending"
        });
        alert("Proof submitted successfully!");
      });
    });
  </script>
</body>
</html>